
import { useParams, useNavigate } from 'react-router-dom';
import { useState, useRef, useEffect } from 'react';
import { Calendar, ArrowRight, FileDown } from 'lucide-react';
import { Button } from "@/components/ui/button";
import ContentStats from "@/components/ContentStats";
import AudioPlayer from "@/components/AudioPlayer";
import SocialShareButtons from "@/components/SocialShareButtons";
import { generateContentPdf } from "@/utils/pdfUtils";

const articlesList = [
  {
    id: 1,
    title: "تذكير عموم المسلمين ببطلان حل الدولتين",
    date: "11/08/2009",
    hijriDate: "20 شعبان 1430هـ",
    content: `الحمد لله القائل في كتابه الكريم "سبحان الذي أسرى بعبده ليلا من المسجد الحرام إلى المسجد الأقصى الذي باركنا حوله..."الإسراء1، والصلاة والسلام على أشرف المرسلين القائل في الحديث الصحيح "لا تقوم الساعة حتى يقاتل المسلمون اليهود فيقتلهم المسلمون حتى يختبئ اليهودي وراء الحجر والشجر فيقول الحجر أو الشجر: يا مسلم، يا عبد الله، هذا يهودي خلفي فتعال فاقتله، إلا الغرقد فإنه من شجر اليهود" وعلى آله وصحبه أجمعين.

في ظل حرارة الصيف اللاهبة وانصراف الناس إلى قضاء العطل الصيفية والترفيه عن النفس بالحلال أو الحرام وفي غفلة من عموم الأمة –عامة وخاصة- إلا ما رحم ربي وفي ظل تلهية حكام الخذلان والاعتلال لشعوبهم وإغراقهم في كم هائل من الحفلات والمهرجانات في طول البلاد العربية وعرضها، على حد قول الشاعر :
هنا وهنالك قام المأتم * شعب يُغنّي وحاكم يترنم
في ظل كل ذلك انعقد مؤتمر فتح السادس –حيث لا نصر ولا فتح على أرض الواقع- وبإذن مرخص من الكيان الصهيوني وتزكية من دول الاستبداد العربي وعلى رأسهم مصر والسعودية والأردن والذين تولوا تزكية محمود عباس غريم ياسر عرفات والذي فُرض عليه قسرا من قبل الإدارة الأمريكية والإسرائيلية، والذي يحظى بالدعم الدولي والعربي والإسرائيلي إنما هم ديناصورات فتح الذين بدلوا وغيروا ونكصوا على أعقابهم من أرباب المال والنفوذ والسلطة الذين يجدون الدعم في بعض العواصم العربية المتخاذلة وسر الدعم الذي يحظى به عباس وجماعته أنه يؤمن بحل الدولتين أو الحكم الذاتي المحدود ويعادي كل فصائل المقاومة الحقيقية وإن رفع في المؤتمر السادس شعارها من باب المكر والخديعة وتضليل الرأي العام واحتواء تيار المقاومة المسلحة داخل حركة فتح في الداخل والخارج إلى أن يتم المؤتمر وتعود حليمة إلى عادتها القديمة، وسوف تكشفه الأيام المقبلة بعون الله تعالى.

*ومن منا لا يتذكر خطاب الرئيس الأمريكي –أوباما- في جامعة القاهرة بتاريخ 04/06/2009 الذي أغرق جماهير المستمعين إليه بمعسول الكلام ولذيذ الأحلام ولكن قاصمة الظهر في خطابه عندما طلب من حركة حماس نبذ العنف ومتى كان جهاد ومقاومة الاستعمار عنفا في عرف أوباما السياسي؟!!! ألم تنل أمريكا استقلالها بعد 80 سنة من القتال ضد التاج البريطاني فيما يسمى بالثورة الأمريكية ألم تطرد الإسبان من كوبا بعد حرب دامت 3 سنوات من 1895 إلى 1898 فيما سمي الحرب الأمريكية الإسبانية. ألم تتوحد الولايات الشمالية والجنوبية بعد حرب أهلية طاحنة دامت 4 سنوات من 1861 إلى 1865 راح ضحيتها حوالي 600.000 قتيل فهل استخدام السلاح ضد المحتل يسمى عنفا يا أوباما؟!!! وأما فاقرة الفواقر حصره الحل للقضية الفلسطينية في الاعتراف بحل الدولتين، ولكن ما يثير الدهشة والاستغراب أن ينال هذا الخطاب الهائم ذلك الترحيب والتصفيق من أغلب المستمعين داخل القاعة وخارجها وفيهم أهل العمائم وشيوخ الأزهر، وكان الواجب الشرعي على هؤلاء العلماء قبل غيرهم إما الرّد المباشر أو الانسحاب من القاعة احتجاجا على الحل المطروح والذي يخالف الشرع أولا، والمواثيق الدولية التي تشرع مقاومة الاستعمار بكل الوسائل، أما الجلوس دون إنكار فيشمله قوله تعالى "إنكم إذا مثلهم".

*لقد أصبح ساسة الغرب والعرب ينادون في كل مناسبة بحل الدولتين ويأتي على رأس تلك الدول مصر والأردن وحتى الجزائر التي ذاقت ويلات الاستعمار يصرح وزير خارجيتها مدلسي بتاريخ 24/06/2009 "إن الجزائر مع حل الدولتين كما نادى به أوباما؟!!! فمتى كان أوباما مرجعية الجزائر في مناصرة القضايا العادلة وماذا لو أن أوباما نادى بالحكم الذاتي للصحراء الغربية، فهل ستخضع الجزائر لذلك الطرح؟!!!.

أما النظام السعودي فقد أصبح من أنصار حل الدولتين رغم أن هذا الحل يخالف أحكام الشريعة وهي تزعم أن مرجعيتها الكتاب والسنة وسلف الأمة؟!!!، لقد أرسل ملك السعودية بمناسبة انعقاد مؤتمر فتح السادس في بيت لحم يزعم فيه أن الدولة الفسلطينية لن تقوم مع وجود الانقسام الداخلي وهذا تهرب من المسؤولية الشرعية والسياسية والقومية، فيما آلت إليه الأوضاع في فلسطين وكأن مصيبة فلسطين وضياعها وخذلانها راجع إلى الانقسام الداخلي بين دعاة المقاومة والجهاد ودعاة التخاذل والاستسلام والرسالة في مثل هذه الظروف هي رسالة خذلان وتهرب من المسؤولية التاريخية ورميها على الانقسام، وما زاد الطين بلة أن الأمين العام لجامعة الدول العربية صرح قائلا "إن رسالة العاهل السعودي لحركة فتح تحدث فيها باسم العرب جميعا" ونحن نقول هذا محض افتراء وكذب فمن نصب عاهل السعودية أميرا على الأمة العربية أو ناطقا رسميا باسمها؟!! وهل يمكن أن نصدق أن الاتقسام الدا��لي أخطر من إسرائيل؟!! وكل ثورات العالم حدث فيها انشقاق بين دعاة المقاومة ودعاة الاستسلام بما في ذلك الثورة الجزائرية رائدة الثورات في العصر الحديث ولا بد لعموم الناس التفريق بين الانشقاق الشرعي والانشقاق المصلحي النفعي ولسنا الآن بصدد ضرب الأمثلة في بيان الانشقاق المشروع والانشقاق الممنوع، والحمد لله أن جورج ميتشل قد فضح هؤلاء الحكام العرب في استجواب له في جريدة نيويورك تايمز بتاريخ 04/08/2009، حيث ظهر أن لهم سياسة مزدوجة في الخفاء والعلن.

* في الوقت الذي تنادي فيه الإدارة الأمريكية والإتحاد الأوروبي وحكام العرب بحل الدولتين يأتي الرد بعد 10 أيام من خطاب أوباما من جامعة دير إلام على لسان ناتنياهو لينسف خطاب أوباما من الأساس ولم يستطع أوباما أن يلجم المارد الإسرائيلي بل أصبح يتعرض للنقد في قلب بلاده آخرها تنديد إيباك الصهيونية بمنح أوباما جائزة الحرية لإحدى الناشطات والبقية تأتي وما أكثر التراجعات التي أصبح أوباما يسقط فيها صباح مساء.

*مما سبق بيانه يجب على العلماء الربانيين بيان الحكم الشرعي فيمن ينادي بحل الدولتين بما في ذلك السلطة الفلسطينية، فهل يعقل المسارعة لإصدار الفتاوى في أمور غير هامة أو تافهة، بالإفتاء في زواج المسيار... أو الرسوم المتحركة بوكيمون وإرضاع الكبير إلى آخر سلسلة الفتاوى العجيبة التي لا تسمن ولا تغني من جوع، إلا في حدود ضيقة، في مقابل السكوت المطبق المريب، إلا ما رحم ربي وقليل ما هم، عن بيان الحكم الشرعي في مثل هذه القضية التي تهم أزيد من مليار مسلم؟!!!، وسوف نتناول هذا الموضوع الهام الخطير في جملة من النقاط قياما بواجب البيان والصدع بكلمة الحق تاركين البقية الهامة لعلماء المسلمين في أنحاء العالم لتكون الشعوب الإسلامية على بصيرة من أمرها لأن حكام المسلمين قد نفضوا أيديهم من القضية الفلسطينية كل بطريقته الخاصة.

أولا:القضية الفلسطينية والسلم العالمي:
*ما زال العقلاء وأهل البصر والبصيرة يحذرون -منذ زمن بعيد- من مغبة عدم إيجاد حل سياسي عادل وشرعي للقضية الفلسطينية العادلة ومن هؤلاء العلامة الإبراهيمي رحمه الله، حيث قال بتاريخ 21 جوان 1948: " أيها الشعب العربي المسلم، في هذه الظروف الدقيقة التي تجتازها فلسطين العربية وفي هذا الصراع العنيف الذي حمل عليه إخوانك العرب حملا وألجئوا إليه إلجاء لا خيار فيه، وفي هذه الحرب المستعمرة التي يوشك أن تضيق بها الرقعة فيتطاير شررها إلى جوانب العالم فتحرقه أو تغرقه" وقال الشيخ أحمد توفيق المدني رحمه الله في جويلية 1937 :"لكن نقطة الإحساس في العالم العربي اليوم إنما هي نقطة فلسطين. والخطر الداهم الذي يهدد العرب في كيانهم، وفي حياتهم، إنما هو خطر فلسطين".

ثانيا: حيرة ال��الم في حل القضية.
*مما لا شك فيه أن العالم بأسره في حيرة من أمره بشأن حل القضية الفلسطينية وقد أشار إلى هذه الحيرة الشيخ الإبراهيمي رحمه الله في سنة 1948 حيث قال :" وفي هذه الأزمة التي عقدها الطمع فعجز عن حلها العالم الذي لم يعرف القناعة، وأنشأها الباطل فلم يستطع التغلب عليها الرؤساء الذين لم يعرفوا الحق، وفي هذه المعركة التي قسمت كلا من العالمين الملحد والمتدين إلى معسكرين: بعض أسلحتهما الحديد والنار، وبعضها الرأي والمكيدة، وبعض أسبابهم إليها الحق الذي لا شبهة فيه، وأكثرها الباطل الذي لا مرية فيه، في هذه الظلمات المتراكمة نتوجه إليك مخلصين بنصيحة تضمن استمرار السير، وحفظ الاتجاه، وسلامة العاقبة".

ثالثا: القضية الفلسطينية ليست محلية بل إسلامية.
*من أقبح وأشنع الكلمات التي يردّدها حكام الاعتلال والذل والإذلال عندما يُتّهمون بخذلان القضية الفلسطينية العادلة "لن نكون ملكيين أكثر من الملك" وهي خدعة مكشوفة أمام الشعوب الإسلامية لأن قضية فلسطين ليست محلية أو ملكا لسلطة محلية يحق لها أن تتصرف فيها كما يحلو لها وهذا ما قرره قادة الفكر والعلم والسياسة عندنا، لقد قام العلامة الشيخ عبد الحميد بن باديس رحمه الله باتصالات مع مفتي القدس الشيخ الأمين الحسيني رحمه الله منذ 1933: "كان للشيخ ابن باديس مراسلات دائمة مع مفتي القدس الأكبر الشيخ الأمين الحسيني.. ومن هؤلاء استطاع الشيخ ابن باديس الوقوف على آخر تطورات الأحداث في الساحة العربية منذ أول اجتماع للمجلس في القدس. وإننا نجد الدليل على هذا الإتصال أنه عندما وقعت حوادث قسنطينة بين المسلمين واليهود في جمادى الأولى 1353 (أغسطس 1934م) قام رئيس اللجنة التنفيذية للمؤتمر الإسلامي بالقدس بإرسال معونة إلى الشيخ عبد الحميد بن باديس مقدارها خمسون جنيها وخمس شلنات (ثلاثة آلاف وستمائة وخمسة وستين فرنكا) وتم توزيعها على عائلات المنكوبين"، ولقد بين الشيخ الإبراهيمي مكانة فلسطين عند كل مسلم في 1948 حيث قال والجزائر تحت الاستعمار "إن الجزائر وطنكم الصغير، وإن إفريقيا الشمالية وطنكم الكبير، وإن فلسطين قطعة من جزيرة العرب التي هي وطنكم الأكبر، وإن الرجل الصحيح الوطنية هو الذي لا تلهيه الأحداث عن القيام بواجبات وطنيه الأصغر والأكبر" بل إن الشيخ عبد الحميد بن باديس جعل الاعتداء على بيت المقدس كالاعتداء على مكة تماما، قال في أوت 1938 "رحاب القدس الشريف مثل رحاب مكة والمدينة، وقد قال الله في المسجد الأقصى في سورة الإسراء "الذي باركنا حوله" ليعرفنا بفضل تلك الرحاب، فكل ما وقع بها كأنه واقع برحاب المسجد الحرام ومسجد طيبة"، ونظرا لمكانة فلسطين في قلب المسلمين فقد وجب التضحية من أجل نصرتها لأنها ليست قضية محلية�� قال الشيخ توفيق المدني رحمه الله في سنة 1937 "إن الواجب المحتم على كل عربي مسلم في أي قطر من أقطار الأرض، هو أن يقف إلى جانب أخيه العربي الفلسطيني، ينصره ويؤازره، ويضحي إلى جانبه أغلى وأعز التضحيات، مهما كلفه ذلك، فالمسألة ليست مسألة بلاد نائية، وليست مسألة محلية لا تهم إلا أهل فلسطين وحدهم، بل إنما هي مسألة العالم العربي بأسره، بل العالم الإسلامي برمته، وكل اقتطاع من أرض فلسطين إنما هو حز في رقبة العرب، ونحر للعالم الإسلامي من وريده".

وقال الشيخ الإبراهيمي رحمه الله في 1948: "أيها العرب! إن قضية فلسطين محنة امتحن الله بها ضائركم وهممكم وأموالكم ووحدتكم، وليست فلسطين لعرب فلسطين وحدهم، وإنما هي للعرب وحدهم، وإنما هي للعرب كلهم، وليست حقوق العرب فيها تنال بأنها حق في نفسها،وليست تنال بالهوينا والضعف،وليست تنال بالشعريات والخطابيات، وإنما تنال بالتصميم والحزم والاتحاد والقوة，
إن الصهيونية وأنصارها مصممون، فقابلوا التصميم بتصميم أقوى منه وقابلوا الاتحاد باتحاد أمتن منه.
وكونوا حائطا لا صدع فيه * وصفا لا يرقع بالكسالى "

*ومن العلماء الذين استنكروا محلية القضية الفلسطينية العلامة السلفي الطيب العقبي رحمه الله، هذا العلامة الذي جمع بين التعليم والدعوة والخطابة والصحافة والنشاط السياسي الداخلي والخارجي، قال هذا الشيخ في 13 أوت 1937:
"لبيك لبيك فلسطين، فما أنت لأهلك فقط ولكن للعرب كلهم للمسلمين أجمعين"، بين فيه حسرته وأفصح عن ألمه تجاه محنة الشعب الفلسطيني المتشرد من ويلات القمع الصهيوني بقوله "لهذا فإن كارثة فلسطين لم تكن بأمر يخص أهلها فحسب.. ولكنها كانت مأساة عامة وكارثة عظمى حلت بالعالم الإسلامي كله والعرب أجمعين ومن الناس اليوم من لا يلهج باسم فلسطين الشهيدة، فلسطين الدامية، فلسطين الثاكلة، فلسطين الباكية، الشاكية الحزينة، فلسطين ضحية الاستعمار الغاشم،...أراد الإنجليز العتاة البغاة تقديمها على مذبح مطامعهم ومصالحهم الخاصة لقمة سائغة للآكلين وغنيمة باردة لشذّاذ العالم ونفاية الأمم من الصهيونيين".`,
    imageUrl: "/lovable-uploads/9b70a61d-fdfe-40af-9a1d-bff43338c387.png"
  }
];

const ArticleDetails = () => {
  const { articleId } = useParams();
  const navigate = useNavigate();
  const [isPlaying, setIsPlaying] = useState(false);
  const [highlightedWordIndex, setHighlightedWordIndex] = useState<number | null>(null);
  const contentRef = useRef<HTMLDivElement>(null);
  const [showFloatingPlayer, setShowFloatingPlayer] = useState(false);
  
  useEffect(() => {
    const handleScroll = () => {
      // Show floating player when scrolled past the main player
      const scrollPosition = window.scrollY;
      setShowFloatingPlayer(scrollPosition > 500);
    };

    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  // Find the article by ID
  const article = articlesList.find(article => article.id.toString() === articleId);
  
  // Handle case when article isn't found
  if (!article) {
    return (
      <div className="min-h-screen flex flex-col items-center justify-center">
        <h1 className="text-3xl font-bold text-navy mb-4">المقال غير موجود</h1>
        <Button 
          variant="outline"
          onClick={() => navigate('/articles')}
          className="flex items-center"
        >
          العودة إلى المقالات
          <ArrowRight className="mr-2" size={16} />
        </Button>
      </div>
    );
  }
  
  // Prepare the content for the audio player and highlighting
  const contentWords = (article.title + ". " + article.content).split(/\s+/);
  
  const handlePlayingProgress = (index: number) => {
    setHighlightedWordIndex(index);
  };
  
  const handlePlayingChange = (playing: boolean) => {
    setIsPlaying(playing);
    if (!playing) {
      setHighlightedWordIndex(null);
    }
  };
  
  const downloadPdf = () => {
    generateContentPdf(
      article.title,
      article.content,
      undefined,
      article.date + (article.hijriDate ? ` (${article.hijriDate})` : '')
    );
  };
  
  return (
    <div className="min-h-screen bg-gray-50">
      <div className="bg-navy text-white py-16">
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
          <Button 
            variant="ghost" 
            onClick={() => navigate('/articles')}
            className="text-white mb-6 hover:bg-navy-light flex items-center"
          >
            <ArrowRight className="ml-2" size={18} />
            العودة إلى المقالات
          </Button>
          <h1 className="text-3xl md:text-4xl font-bold mb-4">{article.title}</h1>
          <div className="flex items-center text-gray-300 space-x-4 space-x-reverse">
            <div className="flex items-center">
              <Calendar size={16} className="ml-1" />
              <span>{article.date}</span>
            </div>
            <div className="flex items-center">
              <span className="text-gold">{article.hijriDate}</span>
            </div>
          </div>
        </div>
      </div>
      
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <ContentStats contentId={articleId || "1"} contentType="article" />
        
        <div className="flex justify-between items-center my-4">
          <Button variant="outline" onClick={downloadPdf} className="flex items-center">
            <FileDown size={16} className="ml-2" />
            تحميل PDF
          </Button>
          <SocialShareButtons 
            title={article.title} 
            text={`مقال: ${article.title}`} 
            compact 
          />
        </div>
        
        {/* Main Audio Player */}
        <AudioPlayer 
          title={article.title}
          content={article.content}
          onPlayingChange={handlePlayingChange}
          onPlayingProgress={handlePlayingProgress}
        />
        
        <article className="bg-white rounded-lg shadow-md p-6 md:p-8">
          {article.imageUrl && (
            <div className="mb-8 flex justify-center">
              <img 
                src={article.imageUrl} 
                alt={article.title} 
                className="max-w-full max-h-96 object-contain rounded-md"
              />
            </div>
          )}
          
          <div className="prose prose-lg max-w-none text-right leading-relaxed" ref={contentRef}>
            {isPlaying ? (
              <div className="mb-4 leading-relaxed text-gray-700">
                {contentWords.map((word, index) => (
                  <span 
                    key={index}
                    className={`content-word ${highlightedWordIndex === index ? 'bg-gold/20 text-navy font-bold' : ''}`}
                  >
                    {word}{' '}
                  </span>
                ))}
              </div>
            ) : (
              article.content.split('\n\n').map((paragraph, index) => (
                <p key={index} className="mb-4">{paragraph}</p>
              ))
            )}
          </div>
        </article>
      </div>

      {/* Floating Audio Player */}
      {showFloatingPlayer && (
        <div className="fixed bottom-4 right-4 z-50 animate-fade-in">
          <AudioPlayer 
            title={article.title}
            content={article.content}
            onPlayingChange={handlePlayingChange}
            onPlayingProgress={handlePlayingProgress}
            floating={true}
          />
        </div>
      )}
    </div>
  );
};

export default ArticleDetails;
